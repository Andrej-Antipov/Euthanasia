#!/bin/bash

app_path="$(ps xao command | grep -i "SleepIt" | grep -v grep | grep -v /bin/bash | sed 's/[^/]*$//' | xargs)"ROOT=$( echo "$app_path""./../Resources" )loc=`defaults read -g AppleLocale | cut -d "_" -f1`; if [[ ! $loc = "ru" ]]; then loc="en"; fi DISPLAY_NOTIFICATION(){"${ROOT}"/terminal-notifier.app/Contents/MacOS/terminal-notifier -title "Euthanasia" -sound Submarine -subtitle "${SUBTITLE}" -message "${MESSAGE}"sleep 1term=`ps`AllTTYcount=`echo $term | grep -Eo ttys[0-9][0-9][0-9] | wc -l | tr - " \t\n"`let "TTYcount=AllTTYcount-MyTTYcount"if [[ ${TTYcount} = 0  ]];then  osascript -e 'quit app "terminal.app"' & exitfi}GET_USER_PASSWORD(){mypassword="0"if (security find-generic-password -a ${USER} -s euthanasia -w) >/dev/null 2>&1; then                mypassword=$(security find-generic-password -a ${USER} -s euthanasia -w)fi}MESSAGE_START(){        if [[ $loc = "ru" ]]; then        SUBTITLE="Сервис усыпления компа ЗАПУЩЕН "        MESSAGE=" "        DISPLAY_NOTIFICATION &        else        SUBTITLE="Service Euthanasia STARTED"        MESSAGE=" "        DISPLAY_NOTIFICATION &        fiDISPLAY_NOTIFICATION}MESSAGE_STOP(){        if [[ $loc = "ru" ]]; then        SUBTITLE="Сервис усыпления компа ОСТАНОВЛЕН "        MESSAGE=" "        DISPLAY_NOTIFICATION &        else        SUBTITLE="Service Euthanasia STOPPED"        MESSAGE=" "        DISPLAY_NOTIFICATION &        fi}GET_USER_PASSWORDif [[ $( echo "${mypassword}" | sudo -S launchctl list | grep "Euthanasia.job" | cut -f3 | grep -x "Euthanasia.job" ) ]]; then echo "${mypassword}" | sudo -S launchctl unload -w /System/Library/LaunchDaemons/Euthanasia.plistMESSAGE_STOPelse	MyTTY=`tty | tr -d " dev/\n"`	term=`ps`;  MyTTYcount=`echo $term | grep -Eo $MyTTY | wc -l | tr - " \t\n"`	echo "${mypassword}" | sudo -S launchctl load -w /System/Library/LaunchDaemons/Euthanasia.plist 	if [[ $( echo "${mypassword}" | sudo -S launchctl list | grep "Euthanasia.job" | cut -f3 | grep -x "Euthanasia.job" ) ]]; then MESSAGE_START; fifi